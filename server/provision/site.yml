---
- hosts: tag_Name_test
  gather_facts: false
  remote_user: ubuntu
  become: true
  vars_files:
  - vars.yml

  pre_tasks:
  - name: 'install python2'
    raw: apt-get -y install python-simplejson

  tasks:
  - name: Install system packages
    apt: pkg={{ item }} update-cache=yes
    with_items: "{{ system_packages }}"
  # - name: Save ssh key to server
  #   copy: src={{ ssh_private_key }} dest=/root/.ssh/id_rsa mode=600
  - name: Clone git repo
    git: repo="{{ git_repo }}"
         dest=/home/ubuntu/okapi
         accept_hostkey=yes

  - name: Install virtualenv
    pip: name=virtualenv
    tags: packages

  - name: Create the virtualenv
    command: virtualenv -p {{ virtualenv_python_version }} {{ virtualenv_path }}
             creates={{ virtualenv_path }}/bin/activate
